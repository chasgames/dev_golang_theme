<!-- template.html -->
<!DOCTYPE html>
<html lang="en" class="sl-theme-dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shoelace Template</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.12.0/cdn/themes/light.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.12.0/cdn/themes/dark.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.12.0/cdn/shoelace-autoloader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #app {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .nav-container {
            background-color: var(--sl-color-neutral-0);
            display: flex;
            align-items: center;
        }

        .logo-container {
            min-width: 80px;
            max-width: 300px;
            height: 40px;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: fit-content;
        }

        .logo-image {
            max-width: 100%;
            max-height: 100%;
            display: none;
        }

        .logo-image.visible {
            display: block;
        }

        .logo-chart {
            width: 100%;
            height: 100%;
            display: none;
        }

        .logo-chart.visible {
            display: block;
        }

        .tab-container {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        sl-tab-group {
            --indicator-color: var(--sl-color-primary-600);
            min-width: 0;
        }

        sl-tab-group::part(nav) {
            justify-content: center;
        }

        .theme-toggle {
            --sl-toggle-size-large: 1.5rem;
            padding: 0.5rem;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="content-area">
            <h1>Scrollable Content</h1>
            <p>This content area scrolls independently.</p>
            <div style="height: 200vh; padding: 1rem;">
                <h2>Keep scrolling...</h2>
                <p>The navigation stays fixed at the bottom.</p>
            </div>
        </div>

        <div class="nav-container">
            <div class="logo-container">
                <img id="logo-image" class="logo-image" alt="Logo" />
                <div id="logo-chart" class="logo-chart"></div>
            </div>
            
            <div class="tab-container">
                <sl-tab-group placement="bottom">
                    <sl-tab slot="nav" panel="general">General</sl-tab>
                    <sl-tab slot="nav" panel="custom">Custom</sl-tab>
                    <sl-tab slot="nav" panel="advanced">Advanced</sl-tab>
                    <sl-tab slot="nav" panel="disabled" disabled>Disabled</sl-tab>
                </sl-tab-group>
            </div>

            <sl-switch class="theme-toggle" size="large" id="theme-toggle" checked>
                <sl-icon id="theme-icon" name="moon-stars"></sl-icon>
            </sl-switch>
        </div>
    </div>
    <script>
        window.addEventListener('load', () => {
            const logoImage = document.getElementById('logo-image');
            const logoChart = document.getElementById('logo-chart');
            const logoContainer = document.querySelector('.logo-container');
            const toggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const tabGroup = document.querySelector('sl-tab-group');
            
            // Get saved theme preference or default to dark
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const isDarkMode = savedTheme === 'dark';
            
            // Set initial theme state
            document.documentElement.classList.toggle('sl-theme-dark', isDarkMode);
            toggle.checked = isDarkMode;
            themeIcon.name = isDarkMode ? 'moon-stars' : 'sun';

            // Initialize theme toggle
            function updateTheme(isDark) {
                document.documentElement.classList.toggle('sl-theme-dark', isDark);
                themeIcon.name = isDark ? 'moon-stars' : 'sun';
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                
                // Update chart colors if chart is visible
                if (window.logoChart && logoChart.classList.contains('visible')) {
                    const textColor = isDark ? '#fff' : '#000';
                    window.logoChart.setOption({
                        graphic: {
                            elements: [{
                                style: {
                                    stroke: textColor,
                                    fill: textColor
                                }
                            }]
                        }
                    });
                }
            }

            toggle.addEventListener('sl-change', () => {
                updateTheme(toggle.checked);
            });

            // For testing, you can set these values to simulate Go parameters
            const testParams = {
                logoUrl: '', // Set to an image URL to test image logo
                logoText: 'Chewbacca smells' // Set to empty string to hide text logo
            };

            // Calculate container width based on text length
            function calculateContainerWidth(text) {
                // Approximate width calculation based on text length
                const charWidth = 20; // Approximate width per character
                const padding = 40; // Extra padding
                return Math.min(300, Math.max(80, text.length * charWidth + padding));
            }

            // Initialize logo based on parameters
            if (testParams.logoUrl) {
                logoImage.src = testParams.logoUrl;
                logoImage.classList.add('visible');
                logoChart.classList.remove('visible');
            } else if (testParams.logoText) {
                logoChart.classList.add('visible');
                logoImage.classList.remove('visible');

                // Set container width based on text length
                const containerWidth = calculateContainerWidth(testParams.logoText);
                logoContainer.style.width = `${containerWidth}px`;

                // Initialize ECharts
                window.logoChart = echarts.init(logoChart);
                const isDark = document.documentElement.classList.contains('sl-theme-dark');
                const textColor = isDark ? '#fff' : '#000';

                const option = {
                    graphic: {
                        elements: [{
                            type: 'text',
                            left: 'center',
                            top: 'center',
                            style: {
                                text: testParams.logoText,
                                fontSize: 30,
                                fontWeight: 'bold',
                                lineDash: [0, 200],
                                lineDashOffset: 0,
                                fill: 'transparent',
                                stroke: textColor,
                                lineWidth: 1
                            },
                            keyframeAnimation: {
                                duration: 2000,
                                loop: false,
                                keyframes: [{
                                    percent: 0.7,
                                    style: {
                                        fill: 'transparent',
                                        lineDashOffset: 200,
                                        lineDash: [200, 0]
                                    }
                                },
                                {
                                    percent: 0.8,
                                    style: {
                                        fill: 'transparent'
                                    }
                                },
                                {
                                    percent: 1,
                                    style: {
                                        fill: textColor
                                    }
                                }]
                            }
                        }]
                    }
                };

                window.logoChart.setOption(option);
            }

            // Set initial active tab
            // Wait for Shoelace components to be ready
            customElements.whenDefined('sl-tab-group').then(() => {
                tabGroup.show('general');
            });

            // Handle window resize for the chart
            window.addEventListener('resize', () => {
                if (window.logoChart) {
                    window.logoChart.resize();
                }
            });
        });
    </script>
</body>
</html>